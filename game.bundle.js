(()=>{var t={472(t){"use strict";t.exports=p5},229(t,e,n){var i;self,i=t=>(()=>{"use strict";var e={991(e){e.exports=t}},n={};function i(t){var r=n[t];if(void 0!==r)return r.exports;var o=n[t]={exports:{}};return e[t](o,o.exports,i),o.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r,o,s,a,u,c,l,h,p={};i.r(p),i.d(p,{Color:()=>r,ControlEventType:()=>l,ControlKey:()=>c,EventEmitter:()=>m,FontAlign:()=>o,FontSize:()=>s,FontVerticalAlign:()=>a,Game:()=>dt,GameView:()=>Yt,RendererContext:()=>B,Sound:()=>u,StateProperty:()=>h,bootstrap:()=>Zt,configs:()=>d,setActiveGame:()=>Qt}),function(t){t.DEFAULT="rgb(19, 26, 18)",t.BLUE="rgb(0, 0, 128)",t.CYAN="rgb(0, 128, 128)",t.GRAY="rgb(128, 128, 128)",t.GREEN="rgb(0, 128, 0)",t.PURPLE="rgb(128, 0, 128)",t.RED="rgb(128, 0, 0)",t.YELLOW="rgb(128, 128, 0)",t.INACTIVE="rgb(166, 183, 165)",t.SHADOW="rgb(93, 105, 92)"}(r||(r={})),function(t){t.CENTER="center",t.LEFT="left",t.RIGHT="right"}(o||(o={})),function(t){t[t.EXTRA_SMALL=0]="EXTRA_SMALL",t[t.SMALL=1]="SMALL",t[t.MEDIUM=2]="MEDIUM",t[t.LARGE=3]="LARGE",t[t.EXTRA_LARGE=4]="EXTRA_LARGE"}(s||(s={})),function(t){t.CENTER="center",t.TOP="top",t.BOTTOM="bottom"}(a||(a={})),function(t){t.SPAWN="./sounds/sound_01.wav",t.SCORE_1="./sounds/sound_15.wav",t.SCORE_2="./sounds/sound_03.wav",t.SCORE_3="./sounds/sound_02.wav",t.KEY_PRESS="./sounds/sound_14.wav",t.ACTION_1="./sounds/sound_05.wav",t.ACTION_2="./sounds/sound_13.wav",t.HIT_1="./sounds/sound_06.wav",t.HIT_2="./sounds/sound_08.wav",t.DODGE="./sounds/sound_07.wav",t.DROP="./sounds/sound_11.wav",t.EXPLOSION="./sounds/sound_09.wav",t.GAME_START="./sounds/sound_04.wav",t.SHOT="./sounds/sound_12.wav",t.START_THEME="./sounds/sound_10.wav"}(u||(u={})),function(t){t.UP="up;control",t.DOWN="down;control",t.LEFT="left;control",t.RIGHT="right;control",t.ACTION="action;control",t.POWER="power;system",t.START_PAUSE="start_pause;system",t.SOUND="sound;system",t.RESET="reset;system",t.EXIT="exit;system",t.COLOR="color;system"}(c||(c={})),function(t){t.PRESSED="pressed",t.HELD="held"}(l||(l={})),function(t){t.ON="on",t.START="start",t.PLAYING="playing",t.GAME_OVER="gameOver",t.COLOR_ENABLED="colorEnabled",t.MUTED="muted"}(h||(h={}));const d={colors:{background:"rgb(172, 189, 173)",active:"rgb(19, 26, 18)",inactive:"rgba(161, 178, 160, 1)",bodyMain:"rgb(0, 68, 187)",bodyButton:"rgb(247, 222, 57)"},screenLayout:{grid:{columns:11,rows:18},hudGrid:{columns:4,rows:4},display:{width:.65,height:.956,margin:.022,borderWeight:.0075},fontSize:{extraSmall:.05,small:.065,medium:.1,large:.125,extraLarge:.15},cell:{margin:.1,padding:.3,strokeWeight:.075}},viewLayout:{bodyHeightWidthMultiplier:1.9,mobileBreakpoint:600,canvas:{widthRatio:.7,aspectRatio:1.114},splashHideDelayMs:250,dimensions:{borderRadiusRatio:.05,borderWidthRatio:.006,button:{smSizeRatio:.08,mdSizeRatio:.18,lgSizeRatio:.25,mobile:{smSizeRatio:.13,mdSizeRatio:.26,lgSizeRatio:.35,fontRatio:.05,smFontRatio:.04,lgFontRatio:.055,spacingRatio:.018},borderRatio:.0045,animationDuration:"0.15s"}},shadowDispersion:"3px"},inputQueryParams:{mainColor:"body-color",buttonColor:"button-color",runningOnApp:"mobile"},selectors:{parent:"#brick-game",splash:"#splash",modalIds:{sessionModal:"#session-modal",sessionContinueYes:"#session-modal-yes",sessionContinueNo:"#session-modal-no"},viewElementIds:{canvas:"brick-game-canvas",container:"container",frame:"frame",buttonContainer:"button-container",smallButtonContainer:"small-button-container",innerButtonContainer:"inner-button-container",mediumButtonContainer:"medium-button-container",directionVerticalContainer:"direction-vertical-container",directionHorizontalContainer:"direction-horizontal-container",largeButtonContainer:"large-button-container"}},storageKeys:{muted:"STATE.MUTED",colorEnabled:"STATE.COLOR_ENABLED",grid:"GAME.GRID",hudGrid:"GAME.HUD_GRID",tickInterval:"GAME.TICK_INTERVAL",score:"GAME.SCORE"},buttonHold:{holdDelayMs:250,holdIntervalMs:50},game:{tickInterval:1e3/30,minTickInterval:1e3/60,debugger:{msInterval:100,enabled:!0},sound:{volume:.025}}},f=function(){function t(t){this._activeKeys=new Map,this._control=t}return t.prototype.handlePress=function(t){var e=this;if(!this._activeKeys.has(t)){this._control.notify(t,l.PRESSED);var n=setTimeout(function(){var n=setInterval(function(){e._control.notify(t,l.HELD)},d.buttonHold.holdIntervalMs),i=e._activeKeys.get(t);i&&(i.hold=n)},d.buttonHold.holdDelayMs);this._activeKeys.set(t,{delay:n,hold:null})}},t.prototype.handleRelease=function(t){var e=this._activeKeys.get(t);e&&(clearTimeout(e.delay),e.hold&&clearInterval(e.hold),this._activeKeys.delete(t))},t}();var g={ArrowUp:c.UP,ArrowDown:c.DOWN,ArrowLeft:c.LEFT,ArrowRight:c.RIGHT,KeyW:c.UP,KeyS:c.DOWN,KeyA:c.LEFT,KeyD:c.RIGHT,KeyJ:c.ACTION,Digit1:c.POWER,Digit2:c.START_PAUSE,Digit3:c.SOUND,Digit4:c.RESET,Digit5:c.EXIT,Digit6:c.COLOR};const y=function(){function t(t){this._inputHandler=new f(t),this._boundHandleKeyDown=this._handleKeyDown.bind(this),this._boundHandleKeyUp=this._handleKeyUp.bind(this)}return t.prototype.bindControls=function(){window.addEventListener("keydown",this._boundHandleKeyDown),window.addEventListener("keyup",this._boundHandleKeyUp)},t.prototype.unbindControls=function(){window.removeEventListener("keydown",this._boundHandleKeyDown),window.removeEventListener("keyup",this._boundHandleKeyUp)},t.prototype._handleKeyDown=function(t){var e=g[t.code];e&&(t.repeat||this._inputHandler.handlePress(e))},t.prototype._handleKeyUp=function(t){var e=g[t.code];e&&this._inputHandler.handleRelease(e)},t}();var v;!function(t){t.TITLE="title",t.PLAYING="playing",t.GAMEOVER="gameover",t.PAUSED="paused"}(v||(v={}));const m=function(){function t(){}return t.subscribe=function(t,e,n){var i=this._formatName(t,n);this._events[i]||(this._events[i]=[]),this._events[i].push(e)},t.unsubscribe=function(t,e,n){var i=this._formatName(t,n);this._events[i]&&(this._events[i]=this._events[i].filter(function(t){return t!==e}))},t.notify=function(t,e){this._events[t]&&this._events[t].forEach(function(t){return t(e)})},t.notifyContextual=function(t,e,n){this.notify(t,e),n.isPlaying()?this.notify(this._formatName(t,v.PLAYING),e):n.isPaused()?this.notify(this._formatName(t,v.PAUSED),e):n.isOn()&&!n.isStarted()?this.notify(this._formatName(t,v.TITLE),e):n.isGameOver()&&this.notify(this._formatName(t,v.GAMEOVER),e)},t._formatName=function(t,e){return e?"".concat(t,":").concat(e):t},t.clear=function(){this._events={}},t._events={},t}();var _=function(){function t(){this._activeListeners=[]}return t.prototype.setup=function(){this._keyBinding=new y(this),this._keyBinding.bindControls()},t.prototype.unbindControls=function(){this._keyBinding.unbindControls(),this._activeListeners.forEach(function(t){var e=t.event,n=t.callback;m.unsubscribe(e,n)}),this._activeListeners=[]},t.prototype.bindControls=function(){this._keyBinding.bindControls()},t.prototype.setModules=function(t){this._modules=t},t.prototype.subscribe=function(t,e,n){this._subscribe(t,e,n)},t.prototype.unsubscribe=function(t,e,n){this._unsubscribe(t,e,n)},t.prototype.subscribeForTitleScreen=function(t,e,n){this._subscribe(t,e,n,v.TITLE)},t.prototype.unsubscribeForTitleScreen=function(t,e,n){this._unsubscribe(t,e,n,v.TITLE)},t.prototype.subscribeForGameOverScreen=function(t,e,n){this._subscribe(t,e,n,v.GAMEOVER)},t.prototype.unsubscribeForGameOverScreen=function(t,e,n){this._unsubscribe(t,e,n,v.GAMEOVER)},t.prototype.subscribeForPlayingScreen=function(t,e,n){this._subscribe(t,e,n,v.PLAYING)},t.prototype.unsubscribeForPlayingScreen=function(t,e,n){this._unsubscribe(t,e,n,v.PLAYING)},t.prototype.subscribeForPausedScreen=function(t,e,n){this._subscribe(t,e,n,v.PAUSED)},t.prototype.unsubscribeForPausedScreen=function(t,e,n){this._unsubscribe(t,e,n,v.PAUSED)},t.prototype._subscribe=function(t,e,n,i){var r="".concat(t,":").concat(e);m.subscribe(r,n,i);var o=i?"".concat(r,":").concat(i):r;this._activeListeners.push({event:o,callback:n})},t.prototype._unsubscribe=function(t,e,n,i){var r="".concat(t,":").concat(e);m.unsubscribe(r,n,i);var o=i?"".concat(r,":").concat(i):r;this._activeListeners=this._activeListeners.filter(function(t){return!(t.event===o&&t.callback===n)})},t.prototype.notify=function(t,e){if(!this._modules)throw new Error("Modules not initialized");var n={key:t,type:e,modules:this._modules},i=this._modules.state,r=this._modules.session,o=!1;r.isModalOpen()||i.isPlaying()&&!r.isSessionResolved()?o=!1:i.isOff()?o=t===c.POWER:!i.isStarted()||i.isPlaying()||i.isGameOver()?o=!0:i.isPaused()&&(o=t.endsWith(";system")),o&&m.notifyContextual("".concat(t,":").concat(e),n,i)},t.prototype.getDebugData=function(){return{total_active_listeners:this._activeListeners.length}},t}();const b=_,E=function(){function t(){}return t.emptyCell=function(t){return{value:0,color:r.DEFAULT,coordinate:t}},t}();var S=function(){return S=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},S.apply(this,arguments)},w=function(){function t(t){this.grid=t}return t.prototype.movePiece=function(t,e){var n=this,i=t.map(function(t){return S(S({},t),{coordinate:{x:t.coordinate.x+(e.x||0),y:t.coordinate.y+(e.y||0)}})}),r=i.some(function(e){if(!n.grid.isCoordinateValid(e.coordinate))return!0;var i,r=n.grid.getCell(e.coordinate);return r&&n.grid.isCellActive(r)&&(i=e.coordinate,!t.some(function(t){return t.coordinate.x===i.x&&t.coordinate.y===i.y}))});return r?t:i},t.prototype.movePieceLeft=function(t){return this.movePiece(t,{x:-1,y:0})},t.prototype.movePieceRight=function(t){return this.movePiece(t,{x:1,y:0})},t.prototype.movePieceUp=function(t){return this.movePiece(t,{x:0,y:-1})},t.prototype.movePieceDown=function(t){return this.movePiece(t,{x:0,y:1})},t.prototype.moveCell=function(t,e){var n={x:t.coordinate.x+(e.x||0),y:t.coordinate.y+(e.y||0)};if(!this.grid.isCoordinateValid(n))return t;var i=this.grid.getCell(n);return i&&this.grid.isCellActive(i)?t:S(S({},t),{coordinate:n})},t.prototype.moveCellLeft=function(t){return this.moveCell(t,{x:-1,y:0})},t.prototype.moveCellRight=function(t){return this.moveCell(t,{x:1,y:0})},t.prototype.moveCellUp=function(t){return this.moveCell(t,{x:0,y:-1})},t.prototype.moveCellDown=function(t){return this.moveCell(t,{x:0,y:1})},t.prototype.getDropPath=function(t){for(var e=t,n=this.movePieceDown(e);n!==e;)e=n,n=this.movePieceDown(e);return e},t.prototype.getRisePath=function(t){for(var e=t,n=this.movePieceUp(e);n!==e;)e=n,n=this.movePieceUp(e);return e},t.prototype.getReachPathLeft=function(t){for(var e=t,n=this.movePieceLeft(e);n!==e;)e=n,n=this.movePieceLeft(e);return e},t.prototype.getReachPathRight=function(t){for(var e=t,n=this.movePieceRight(e);n!==e;)e=n,n=this.movePieceRight(e);return e},t}();const x=w;var P=function(){return P=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},P.apply(this,arguments)},R=function(){function t(t){this.grid=t}return t.prototype.rotatePiece=function(t,e,n){var i=this;void 0===n&&(n=!0);var r=t.map(function(t){var i=t.coordinate.x-e.x,r=t.coordinate.y-e.y,o=n?-r:r,s=n?i:-i;return P(P({},t),{coordinate:{x:e.x+o,y:e.y+s}})}),o=r.some(function(e){if(!i.grid.isCoordinateValid(e.coordinate))return!0;var n,r=i.grid.getCell(e.coordinate);return r&&i.grid.isCellActive(r)&&(n=e.coordinate,!t.some(function(t){return t.coordinate.x===n.x&&t.coordinate.y===n.y}))});return o?t:r},t.prototype.mirrorPiece=function(t,e){if(0===t.length)return[];var n=this.getPieceBounds(t),i="x"===e?(n.min.x+n.max.x)/2:(n.min.y+n.max.y)/2;return t.map(function(t){return P(P({},t),{coordinate:{x:"x"===e?Math.round(2*i-t.coordinate.x):t.coordinate.x,y:"y"===e?Math.round(2*i-t.coordinate.y):t.coordinate.y}})})},t.prototype.getPieceBounds=function(t){var e=t.map(function(t){return t.coordinate.x}),n=t.map(function(t){return t.coordinate.y});return{min:{x:Math.min.apply(Math,e),y:Math.min.apply(Math,n)},max:{x:Math.max.apply(Math,e),y:Math.max.apply(Math,n)}}},t}();const O=R;var C=function(){return C=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},C.apply(this,arguments)},T=function(){function t(t){this.grid=t}return t.prototype.getFullRows=function(){for(var t=[],e=0;e<this.grid.height;e++){for(var n=!0,i=0;i<this.grid.width;i++){var r=this.grid.getCell({x:i,y:e});if(r&&!this.grid.isCellActive(r)){n=!1;break}}n&&t.push(e)}return t},t.prototype.getFullColumns=function(){for(var t=[],e=0;e<this.grid.width;e++){for(var n=!0,i=0;i<this.grid.height;i++){var r=this.grid.getCell({x:e,y:i});if(r&&!this.grid.isCellActive(r)){n=!1;break}}n&&t.push(e)}return t},t.prototype.getNeighbors=function(t,e){var n=this;void 0===e&&(e=!1);var i=[],r=[{x:-1,y:0},{x:1,y:0},{x:0,y:-1},{x:0,y:1}];return e&&r.push({x:-1,y:-1},{x:1,y:-1},{x:-1,y:1},{x:1,y:1}),r.forEach(function(e){var r={x:t.x+e.x,y:t.y+e.y};if(n.grid.isCoordinateValid(r)){var o=n.grid.getCell(r);o&&i.push(o)}}),i},t.prototype.findConnectedCells=function(t){var e=this,n=this.grid.getCell(t);if(!n||!this.grid.isCellActive(n))return[];var i=n.value,r=[],o=new Set,s=[t],a=function(t){return"".concat(t.x,",").concat(t.y)};for(o.add(a(t));s.length>0;){var u=s.shift(),c=this.grid.getCell(u);c.value===i&&(r.push(c),[{x:u.x-1,y:u.y},{x:u.x+1,y:u.y},{x:u.x,y:u.y-1},{x:u.x,y:u.y+1}].forEach(function(t){var n=a(t),i=e.grid.getCell(t);e.grid.isCoordinateValid(t)&&!o.has(n)&&i&&e.grid.isCellActive(i)&&(o.add(n),s.push(t))}))}return r},t.prototype.swapCells=function(t,e){var n=C({},this.grid.getCell(t)),i=C({},this.grid.getCell(e));this.grid.stampCell(C(C({},i),{coordinate:t})),this.grid.stampCell(C(C({},n),{coordinate:e}))},t}();const A=T;var I=function(){function t(t){this.grid=t}return t.prototype.isRowFull=function(t){var e=this.grid.getGrid();return!(t<0||t>=this.grid.height)&&e[t].every(function(t){return t.value>0})},t.prototype.isRowEmpty=function(t){var e=this.grid.getGrid();return t<0||t>=this.grid.height||e[t].every(function(t){return 0===t.value})},t.prototype.clearRow=function(t){var e=this.grid.getGrid();if(!(t<0||t>=this.grid.height))for(var n=0;n<this.grid.width;n++)e[t][n]=E.emptyCell({x:n,y:t})},t.prototype.shiftRowsDown=function(t){for(var e=this.grid.getGrid(),n=t;n>0;n--)for(var i=0;i<this.grid.width;i++){var r=e[n-1][i];e[n][i].value=r.value,e[n][i].color=r.color}this.clearRow(0)},t.prototype.shiftRowsUp=function(t){for(var e=this.grid.getGrid(),n=t;n<this.grid.height-1;n++)for(var i=0;i<this.grid.width;i++){var r=e[n+1][i];e[n][i].value=r.value,e[n][i].color=r.color}this.clearRow(this.grid.height-1)},t.prototype.clearFullRows=function(){for(var t=0,e=this.grid.height-1;e>=0;e--)this.isRowFull(e)&&(this.clearRow(e),this.shiftRowsDown(e),t++,e++);return t},t.prototype.isColumnFull=function(t){var e=this.grid.getGrid();if(t<0||t>=this.grid.width)return!1;for(var n=0;n<this.grid.height;n++)if(0===e[n][t].value)return!1;return!0},t.prototype.isColumnEmpty=function(t){var e=this.grid.getGrid();if(t<0||t>=this.grid.width)return!0;for(var n=0;n<this.grid.height;n++)if(0!==e[n][t].value)return!1;return!0},t.prototype.clearColumn=function(t){var e=this.grid.getGrid();if(!(t<0||t>=this.grid.width))for(var n=0;n<this.grid.height;n++)e[n][t]=E.emptyCell({x:t,y:n})},t.prototype.shiftColumnsRight=function(t){for(var e=this.grid.getGrid(),n=t;n>0;n--)for(var i=0;i<this.grid.height;i++){var r=e[i][n-1];e[i][n].value=r.value,e[i][n].color=r.color}this.clearColumn(0)},t.prototype.shiftColumnsLeft=function(t){for(var e=this.grid.getGrid(),n=t;n<this.grid.width-1;n++)for(var i=0;i<this.grid.height;i++){var r=e[i][n+1];e[i][n].value=r.value,e[i][n].color=r.color}this.clearColumn(this.grid.width-1)},t.prototype.clearFullColumns=function(){for(var t=0,e=this.grid.width-1;e>=0;e--)this.isColumnFull(e)&&(this.clearColumn(e),this.shiftColumnsRight(e),t++,e++);return t},t}();const M=I;var L=function(){function t(t){this.grid=t}return t.prototype.isAreaOccupied=function(t){var e=this;return t.some(function(t){if(!e.grid.isCoordinateValid(t))return!0;var n=e.grid.getCell(t);return n&&e.grid.isCellActive(n)})},t.prototype.fillArea=function(t,e,n,i){for(var r=Math.max(0,Math.min(t.x,e.x)),o=Math.min(this.grid.width-1,Math.max(t.x,e.x)),s=Math.max(0,Math.min(t.y,e.y)),a=Math.min(this.grid.height-1,Math.max(t.y,e.y)),u=s;u<=a;u++)for(var c=r;c<=o;c++)this.grid.setCellValue({x:c,y:u},n),this.grid.setCellColor({x:c,y:u},i)},t.prototype.stampPiece=function(t){var e=this;t.forEach(function(t){return e.grid.stampCell(t)})},t.prototype.stampCell=function(t){this.grid.setCellValue(t.coordinate,t.value),this.grid.setCellColor(t.coordinate,t.color)},t}();const D=L;var G=function(){function t(){this._grid=[],this.serialId="grid",this._movementEngine=new x(this),this._transformEngine=new O(this),this._analysisEngine=new A(this),this._lineEngine=new M(this),this._regionEngine=new D(this)}return t.prototype.getGrid=function(){return this._grid},Object.defineProperty(t.prototype,"width",{get:function(){return d.screenLayout.grid.columns},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return d.screenLayout.grid.rows},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"topRow",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottomRow",{get:function(){return this.height-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftColumn",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightColumn",{get:function(){return this.width-1},enumerable:!1,configurable:!0}),t.prototype.setup=function(){this.resetGrid()},t.prototype.resetGrid=function(){this._grid=[];for(var t=0;t<this.height;t++){this._grid[t]=[];for(var e=0;e<this.width;e++)this._grid[t][e]=E.emptyCell({x:e,y:t})}},t.prototype.forEach=function(t){for(var e=0;e<this.height;e++)for(var n=0;n<this.width;n++)t(this._grid[e][n])},t.prototype.isCoordinateValid=function(t){return t.x>=0&&t.x<this.width&&t.y>=0&&t.y<this.height},t.prototype.getCell=function(t){return this.isCoordinateValid(t)?this._grid[t.y][t.x]:null},t.prototype.setCellValue=function(t,e){this.isCoordinateValid(t)&&(this._grid[t.y][t.x].value=e)},t.prototype.setCellColor=function(t,e){this.isCoordinateValid(t)&&(this._grid[t.y][t.x].color=e)},t.prototype.isCellActive=function(t){return null!==t&&t.value>0},t.prototype.isCellInactive=function(t){return null!==t&&0===t.value},t.prototype.isRowFull=function(t){return this._lineEngine.isRowFull(t)},t.prototype.isRowEmpty=function(t){return this._lineEngine.isRowEmpty(t)},t.prototype.clearRow=function(t){this._lineEngine.clearRow(t)},t.prototype.shiftRowsDown=function(t){this._lineEngine.shiftRowsDown(t)},t.prototype.shiftRowsUp=function(t){this._lineEngine.shiftRowsUp(t)},t.prototype.clearFullRows=function(){return this._lineEngine.clearFullRows()},t.prototype.isColumnFull=function(t){return this._lineEngine.isColumnFull(t)},t.prototype.isColumnEmpty=function(t){return this._lineEngine.isColumnEmpty(t)},t.prototype.clearColumn=function(t){this._lineEngine.clearColumn(t)},t.prototype.shiftColumnsRight=function(t){this._lineEngine.shiftColumnsRight(t)},t.prototype.shiftColumnsLeft=function(t){this._lineEngine.shiftColumnsLeft(t)},t.prototype.clearFullColumns=function(){return this._lineEngine.clearFullColumns()},t.prototype.isAreaOccupied=function(t){return this._regionEngine.isAreaOccupied(t)},t.prototype.fillArea=function(t,e,n,i){this._regionEngine.fillArea(t,e,n,i)},t.prototype.stampPiece=function(t){this._regionEngine.stampPiece(t)},t.prototype.stampCell=function(t){this._regionEngine.stampCell(t)},t.prototype.movePiece=function(t,e){return this._movementEngine.movePiece(t,e)},t.prototype.movePieceLeft=function(t){return this._movementEngine.movePieceLeft(t)},t.prototype.movePieceRight=function(t){return this._movementEngine.movePieceRight(t)},t.prototype.movePieceUp=function(t){return this._movementEngine.movePieceUp(t)},t.prototype.movePieceDown=function(t){return this._movementEngine.movePieceDown(t)},t.prototype.moveCell=function(t,e){return this._movementEngine.moveCell(t,e)},t.prototype.moveCellLeft=function(t){return this._movementEngine.moveCellLeft(t)},t.prototype.moveCellRight=function(t){return this._movementEngine.moveCellRight(t)},t.prototype.moveCellUp=function(t){return this._movementEngine.moveCellUp(t)},t.prototype.moveCellDown=function(t){return this._movementEngine.moveCellDown(t)},t.prototype.rotatePiece=function(t,e,n){return void 0===n&&(n=!0),this._transformEngine.rotatePiece(t,e,n)},t.prototype.getFullRows=function(){return this._analysisEngine.getFullRows()},t.prototype.getFullColumns=function(){return this._analysisEngine.getFullColumns()},t.prototype.getDropPath=function(t){return this._movementEngine.getDropPath(t)},t.prototype.getRisePath=function(t){return this._movementEngine.getRisePath(t)},t.prototype.getReachPathLeft=function(t){return this._movementEngine.getReachPathLeft(t)},t.prototype.getReachPathRight=function(t){return this._movementEngine.getReachPathRight(t)},t.prototype.getNeighbors=function(t,e){return void 0===e&&(e=!1),this._analysisEngine.getNeighbors(t,e)},t.prototype.findConnectedCells=function(t){return this._analysisEngine.findConnectedCells(t)},t.prototype.mirrorPiece=function(t,e){return this._transformEngine.mirrorPiece(t,e)},t.prototype.swapCells=function(t,e){this._analysisEngine.swapCells(t,e)},t.prototype.getPieceBounds=function(t){return this._transformEngine.getPieceBounds(t)},t.prototype.getDebugData=function(){return{width:this.width,height:this.height,activeCells:this._grid.flat().filter(function(t){return t.value>0}).length}},t.prototype.serialize=function(){return JSON.stringify({grid:this._grid})},t.prototype.deserialize=function(t){var e=JSON.parse(t);this._grid=e.grid},t}();const k=G,B=function(){function t(){}return t.init=function(t){this._p?console.warn("[BrickEngine] RendererContext is already initialized. Ignoring subsequent initialization."):this._p=t},Object.defineProperty(t,"p",{get:function(){if(!this._p)throw new Error("RendererContext not initialized yet. Ensure the Game object has been created.");return this._p},enumerable:!1,configurable:!0}),t.reset=function(){this._p=void 0},t}(),F=function(){function t(){}return t.getRelativeWidth=function(t){return t*B.p.width},t.getRelativeHeight=function(t){return t*B.p.height},t}();var N=function(){function t(){}return t.prototype.setup=function(t){this._rendererMetrics=t;var e=d.screenLayout.cell,n=e.margin,i=e.padding,r=e.strokeWeight,o=this._rendererMetrics.cell.size;this._cellPreCalculatedGeometry={innerOffset:n*o,innerSize:o-n*o*2,paddingOffset:i*o,paddingSize:o-i*o*2,strokeWeight:r*o},this._renderStaticElements()},t.prototype.render=function(t,e){var n=B.p;n.push(),n.image(this._staticGraphics,0,0),this.renderGrid(t,e.state),n.pop()},t.prototype._renderStaticElements=function(){var t=B.p,e=d.screenLayout.display.borderWeight;this._staticGraphics=t.createGraphics(t.width,t.height),this._staticGraphics.background(d.colors.background),this._staticGraphics.strokeWeight(F.getRelativeWidth(e)),this._staticGraphics.noFill(),this._staticGraphics.stroke(d.colors.active),this._staticGraphics.rect(this._rendererMetrics.display.origin.x,this._rendererMetrics.display.origin.y,this._rendererMetrics.display.width,this._rendererMetrics.display.height)},t.prototype.renderCell=function(t,e){var n=t.coordinate,i=t.color,o=t.value,s=B.p,a=n.x,u=n.y,c=this._cellPreCalculatedGeometry,l=c.innerOffset,h=c.innerSize,p=c.paddingOffset,d=c.paddingSize,f=c.strokeWeight;i=0===o||!e.isPlaying()&&!e.isPaused()?r.INACTIVE:e.isColorEnabled()?i:r.DEFAULT,s.push(),s.translate(this._rendererMetrics.display.origin.x+a*this._rendererMetrics.cell.size,this._rendererMetrics.display.origin.y+u*this._rendererMetrics.cell.size),s.strokeWeight(f),s.stroke(i),s.noFill(),s.rect(l,l,h,h),s.fill(i),s.rect(p,p,d,d),s.pop()},t.prototype.renderGrid=function(t,e){var n=this;t.forEach(function(t){t.forEach(function(t){n.renderCell(t,e)})})},t}();const z=N;var H=function(){function t(){}return t.getRelativeCoordinate=function(t){return{x:F.getRelativeWidth(t.x),y:F.getRelativeHeight(t.y)}},t.getDisplayPosX=function(t,e){var n=d.screenLayout.display.margin;return e*t+F.getRelativeWidth(n)},t.getDisplayPosY=function(t,e){var n=d.screenLayout.display.margin;return e*t+F.getRelativeHeight(n)},t.getHudPosX=function(t,e){var n=B.p,i=d.screenLayout.display.margin,r=F.getRelativeWidth(i),o=e+2*r;return(n.width-o-r)*t+o},t.getHudPosY=function(t,e){var n=d.screenLayout.display.margin;return e*t+F.getRelativeHeight(n)},t}();const j=H;var U=function(){function t(){}return t.prototype.setup=function(t){this._cellSize=t.cell.size,this._gridOrigin={x:j.getHudPosX(.078,t.display.width),y:j.getHudPosY(.375,t.display.height)},this._hudBorderRect={x:this._gridOrigin.x-F.getRelativeWidth(.005),y:this._gridOrigin.y-F.getRelativeHeight(.005),w:4*this._cellSize+F.getRelativeWidth(.01),h:4*this._cellSize+F.getRelativeHeight(.01)}},t.prototype.render=function(t,e){this._renderHud(e),this._drawHudGrid(e)},t.prototype._renderHud=function(t){var e=B.p,n=t.text,i=t.state,r=t.score;e.push(),n.setTextSize(s.SMALL),n.setInactiveText(),n.setTextAlign(o.LEFT,a.BOTTOM),n.textOnHud("88888888",{x:.05,y:.13}),n.textOnHud("88888888",{x:.05,y:.3}),n.textOnHud("88 - 88",{x:.05,y:.8}),i.isOn()&&n.setActiveText(),n.textOnHud("Score",{x:.05,y:.06}),n.textOnHud(r.score.toString(),{x:.05,y:.13}),n.textOnHud("Hi-Score",{x:.05,y:.23}),n.textOnHud(r.highScore.toString(),{x:.05,y:.3}),n.textOnHud("Level",{x:.05,y:.72});var u="".concat(r.level<10?"0"+r.level:r.level," - ").concat(r.maxLevel);n.textOnHud(u,{x:.05,y:.8}),n.setTextAlign(o.CENTER,a.BOTTOM),i.isPaused()?n.setActiveText():n.setInactiveText(),n.textOnHud("Paused",{x:.5,y:.9}),i.isOn()&&i.isMuted()?n.setActiveText():n.setInactiveText(),n.textOnHud("Muted",{x:.5,y:.97}),e.pop(),this._drawHudGrid(t)},t.prototype._drawHudGrid=function(t){var e=this,n=B.p,i=t.hudGrid,o=t.state;n.push(),i.forEach(function(t){var n=t.coordinate,i=n.x,s=n.y;o.isOff()&&!o.isPlaying()&&(t.value=0);var a=0!==t.value?r.DEFAULT:r.INACTIVE;o.isColorEnabled()&&0!==t.value&&(a=t.color),e.drawCellElement({w:e._cellSize,h:e._cellSize,posX:e._gridOrigin.x+e._cellSize*i,posY:e._gridOrigin.y+e._cellSize*s,color:a})}),n.noFill(),n.stroke(o.isOn()?r.DEFAULT:r.INACTIVE),n.rect(this._hudBorderRect.x,this._hudBorderRect.y,this._hudBorderRect.w,this._hudBorderRect.h),n.pop()},t.prototype.drawCellElement=function(t){var e=t.w,n=t.posX,i=t.posY,r=t.color,o=B.p,s=d.screenLayout.cell,a=s.margin,u=s.padding,c=a*e,l=e-a*e*2,h=u*e,p=e-u*e*2,f=s.strokeWeight*e;o.push(),o.translate(n,i),o.strokeWeight(f),o.stroke(r),o.noFill(),o.rect(c,c,l,l),o.fill(r),o.rect(h,h,p,p),o.pop()},t}();const V=U;var W=function(){function t(){}return t.prototype.addRenderer=function(t){this._renderers.push(t)},t.prototype.setup=function(){var t=this;this._displayRenderer=new z,this._hudRenderer=new V,this._renderers=[],this.addRenderer(this._displayRenderer),this.addRenderer(this._hudRenderer),this._calculateMetrics(),this._renderers.forEach(function(e){return e.setup(t.rendererMetrics)})},t.prototype._calculateMetrics=function(){var t=d.screenLayout.display,e=t.width,n=t.height,i=t.margin,r=d.screenLayout.grid.columns,o=F.getRelativeWidth(e),s=F.getRelativeHeight(n),a=j.getRelativeCoordinate({x:i,y:i}),u=o/r,c={x:j.getHudPosX(0,o),y:j.getHudPosY(0,s)},l=j.getHudPosX(1,o)-c.x,h=j.getHudPosY(1,s)-c.y;this._rendererMetrics={display:{width:o,height:s,origin:a},hud:{width:l,height:h,origin:c},cell:{size:u}}},t.prototype.render=function(t,e){this._renderers.forEach(function(n){return n.render(t,e)})},Object.defineProperty(t.prototype,"rendererMetrics",{get:function(){return this._rendererMetrics},enumerable:!1,configurable:!0}),t.prototype.getDebugData=function(){return{display_width:this._rendererMetrics.display.width.toFixed(2),display_height:this._rendererMetrics.display.height.toFixed(2),hud_width:this._rendererMetrics.hud.width.toFixed(2),hud_height:this._rendererMetrics.hud.height.toFixed(2),cell_size:this._rendererMetrics.cell.size.toFixed(2)}},t}();const K=W;var Y,X=((Y={})[h.ON]={defaultValue:!1},Y[h.START]={defaultValue:!1},Y[h.PLAYING]={defaultValue:!1},Y[h.GAME_OVER]={defaultValue:!1},Y[h.COLOR_ENABLED]={defaultValue:!0,storageKey:"colorEnabled"},Y[h.MUTED]={defaultValue:!1,storageKey:"muted"},Y);const J=function(){function t(){this._state=new Map}return t.prototype.setup=function(){var t=this;Object.values(h).forEach(function(e){var n=X[e];t._state.set(e,n.defaultValue)}),this._loadPersistentState()},t.prototype._loadPersistentState=function(){var t=this;Object.values(h).forEach(function(e){var n=X[e];if(n.storageKey){var i=localStorage.getItem(n.storageKey);null!==i&&t._state.set(e,JSON.parse(i))}})},t.prototype._set=function(t,e){if(this._state.get(t)!==e){this._state.set(t,e);var n=X[t];n.storageKey&&localStorage.setItem(n.storageKey,JSON.stringify(e)),this.notify(t)}},t.prototype.notify=function(t){var e=this._state.get(t);m.notifyContextual(t,e,this)},t.prototype.isOn=function(){return this._state.get(h.ON)},t.prototype.isOff=function(){return!this.isOn()},t.prototype.isStarted=function(){return this._state.get(h.START)},t.prototype.isPlaying=function(){return this._state.get(h.PLAYING)},t.prototype.isPaused=function(){return this.isStarted()&&!this.isPlaying()&&!this.isGameOver()},t.prototype.isGameOver=function(){return this._state.get(h.GAME_OVER)},t.prototype.turnOn=function(){this._set(h.ON,!0),this._set(h.START,!1),this._set(h.PLAYING,!1),this._set(h.GAME_OVER,!1)},t.prototype.turnOff=function(){this._set(h.ON,!1),this._set(h.START,!1),this._set(h.PLAYING,!1),this._set(h.GAME_OVER,!1)},t.prototype.startGame=function(){this.isOn()&&(this._set(h.START,!0),this._set(h.PLAYING,!0),this._set(h.GAME_OVER,!1))},t.prototype.resetGameOver=function(){this._set(h.GAME_OVER,!1),this._set(h.START,!0),this._set(h.PLAYING,!0)},t.prototype.exitGame=function(){this._set(h.START,!1),this._set(h.PLAYING,!1),this._set(h.GAME_OVER,!1)},t.prototype.pause=function(){this.isStarted()&&!this.isGameOver()&&this._set(h.PLAYING,!1)},t.prototype.resume=function(){this.isStarted()&&!this.isGameOver()&&this._set(h.PLAYING,!0)},t.prototype.triggerGameOver=function(){this._set(h.PLAYING,!1),this._set(h.GAME_OVER,!0)},t.prototype.resetGame=function(){this.isOn()&&(this._set(h.GAME_OVER,!1),this._set(h.START,!0),this._set(h.PLAYING,!0))},t.prototype.isColorEnabled=function(){return this._state.get(h.COLOR_ENABLED)},t.prototype.setColorEnabled=function(t){this._set(h.COLOR_ENABLED,t)},t.prototype.isMuted=function(){return this._state.get(h.MUTED)},t.prototype.setMuted=function(t){this._set(h.MUTED,t)},t.prototype.toggleColorEnabled=function(){this.setColorEnabled(!this.isColorEnabled())},t.prototype.toggleMuted=function(){this.setMuted(!this.isMuted())},t.prototype.subscribe=function(t,e){this._subscribe(t,e)},t.prototype.unsubscribe=function(t,e){this._unsubscribe(t,e)},t.prototype.subscribeForTitleScreen=function(t,e){this._subscribe(t,e,v.TITLE)},t.prototype.unsubscribeForTitleScreen=function(t,e){this._unsubscribe(t,e,v.TITLE)},t.prototype.subscribeForGameOverScreen=function(t,e){this._subscribe(t,e,v.GAMEOVER)},t.prototype.unsubscribeForGameOverScreen=function(t,e){this._unsubscribe(t,e,v.GAMEOVER)},t.prototype.subscribeForPlayingScreen=function(t,e){this._subscribe(t,e,v.PLAYING)},t.prototype.unsubscribeForPlayingScreen=function(t,e){this._unsubscribe(t,e,v.PLAYING)},t.prototype.subscribeForPausedScreen=function(t,e){this._subscribe(t,e,v.PAUSED)},t.prototype.unsubscribeForPausedScreen=function(t,e){this._unsubscribe(t,e,v.PAUSED)},t.prototype._subscribe=function(t,e,n){m.subscribe(t,e,n)},t.prototype._unsubscribe=function(t,e,n){m.unsubscribe(t,e,n)},t.prototype.getDebugData=function(){return{on:this.isOn(),start:this.isStarted(),playing:this.isPlaying(),paused:this.isPaused(),game_over:this.isGameOver(),color_enabled:this.isColorEnabled(),muted:this.isMuted()}},t}();var q=function(){function t(){this.defaultFontFamily="retro-gamming",this.fontSizes=[0]}return t.prototype.setup=function(){var t=B.p,e=d.screenLayout.fontSize,n=e.extraSmall,i=e.small,r=e.medium,o=e.large,a=e.extraLarge;t.textFont(this.defaultFontFamily),this.fontSizes=[],this.fontSizes[s.EXTRA_SMALL]=F.getRelativeWidth(n),this.fontSizes[s.SMALL]=F.getRelativeWidth(i),this.fontSizes[s.MEDIUM]=F.getRelativeWidth(r),this.fontSizes[s.LARGE]=F.getRelativeWidth(o),this.fontSizes[s.EXTRA_LARGE]=F.getRelativeWidth(a)},t.prototype.setRendererMetrics=function(t){this._rendererMetrics=t},t.prototype.setTextState=function(t){var e=B.p,n=d.colors,i=n.active,r=n.inactive;e.fill(t?i:r)},t.prototype.setActiveText=function(){this.setTextState(!0)},t.prototype.setInactiveText=function(){this.setTextState(!1)},t.prototype.setTextSize=function(t){B.p.textSize(this.fontSizes[t])},t.prototype.setTextAlign=function(t,e){B.p.textAlign(t,e)},t.prototype.textOnHud=function(t,e){var n=B.p,i=j.getHudPosX(e.x,this._rendererMetrics.display.width),r=j.getHudPosY(e.y,this._rendererMetrics.display.height);n.text(t,i,r)},t.prototype.textOnDisplay=function(t,e){var n=B.p,i=j.getDisplayPosX(e.x,this._rendererMetrics.display.width),r=j.getDisplayPosY(e.y,this._rendererMetrics.display.height);n.text(t,i,r)},t.prototype.getDebugData=function(){return{current_font_family:this.defaultFontFamily,font_sizes_count:this.fontSizes.length}},t}();const Q=q,Z=function(){function t(){this._tickAccumulator=0,this._initialTickInterval=d.game.tickInterval,this._minTickInterval=d.game.minTickInterval,this._tickInterval=d.game.tickInterval,this._fps=0,this._tps=0,this._tickCounter=0,this._totalTicks=0,this._timeSinceLastTpsUpdate=0,this._totalElapsedTime=0,this.serialId="time"}return t.prototype.setup=function(){this.reset()},t.prototype.update=function(t){this._tickAccumulator+=t,this._totalElapsedTime+=t,this._fps=1e3/t,this._timeSinceLastTpsUpdate+=t,this._timeSinceLastTpsUpdate>=1e3&&(this._tps=this._tickCounter,this._tickCounter=0,this._timeSinceLastTpsUpdate-=1e3)},t.prototype.shouldTick=function(){return this._tickAccumulator>=this._tickInterval&&(this._tickAccumulator-=this._tickInterval,this._tickCounter++,this._totalTicks++,!0)},t.prototype.reset=function(){this._tickAccumulator=0,this._fps=0,this._tps=0,this._tickCounter=0,this._totalTicks=0,this._timeSinceLastTpsUpdate=0,this._totalElapsedTime=0,this._tickInterval=this._initialTickInterval},Object.defineProperty(t.prototype,"tickInterval",{get:function(){return this._tickInterval},set:function(t){this._tickInterval=t},enumerable:!1,configurable:!0}),t.prototype.incrementTickInterval=function(t){this.tickInterval=this._tickInterval+t},t.prototype.decrementTickInterval=function(t){var e=Math.max(this._minTickInterval,this._tickInterval-t);this.tickInterval=e},t.prototype.getDebugData=function(){return{fps:Math.round(this._fps),tps:this._tps,tick_interval:this._tickInterval.toFixed(2),tick_accumulator:this._tickAccumulator.toFixed(2)}},t.prototype.serialize=function(){return JSON.stringify({tickInterval:this._tickInterval})},t.prototype.deserialize=function(t){var e=JSON.parse(t);this._tickInterval=e.tickInterval},t.prototype.setTickInterval=function(t){this._tickInterval=t},t.prototype.setMinTickInterval=function(t){this._minTickInterval=t},Object.defineProperty(t.prototype,"totalTicks",{get:function(){return this._totalTicks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"elapsedTime",{get:function(){return this._totalElapsedTime},enumerable:!1,configurable:!0}),t.prototype.isTickEvery=function(t){return this._totalTicks>0&&this._totalTicks%t===0},t.prototype.captureInitialState=function(){this._initialTickInterval=this._tickInterval},t}();var $=function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(s,a)}u((i=i.apply(t,e||[])).next())})},tt=function(t,e){var n,i,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},et=function(){function t(){this._buffers=new Map,this._activeSources=new Map,this._volume=1}return t.prototype.setup=function(){var t=d.game.sound.volume;this._volume=t;var e=window.AudioContext||window.webkitAudioContext;this._audioContext=new e({latencyHint:"interactive"}),this._gainNode=this._audioContext.createGain(),this._gainNode.connect(this._audioContext.destination),this._updateGain(),this._loadAll()},t.prototype.play=function(t){return $(this,void 0,void 0,function(){var e,n,i;return tt(this,function(r){return"suspended"===this._audioContext.state&&this._audioContext.resume(),(e=this._buffers.get(t))?((n=this._audioContext.createBufferSource()).buffer=e,n.connect(this._gainNode),this._activeSources.has(t)||this._activeSources.set(t,[]),(i=this._activeSources.get(t)).push(n),n.onended=function(){var t=i.indexOf(n);t>-1&&i.splice(t,1)},n.start(0),[2]):(console.warn("Sound buffer not found for: ".concat(t)),[2])})})},t.prototype.stop=function(t){return $(this,void 0,void 0,function(){var e;return tt(this,function(n){return(e=this._activeSources.get(t))&&(e.forEach(function(t){try{t.stop()}catch(t){}}),e.length=0),[2]})})},t.prototype.stopAll=function(){return $(this,void 0,void 0,function(){var t,e,n,i;return tt(this,function(r){switch(r.label){case 0:t=Array.from(this._activeSources.keys()),e=0,n=t,r.label=1;case 1:return e<n.length?(i=n[e],[4,this.stop(i)]):[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},t.prototype._updateGain=function(){var t=!!this._state&&this._state.isMuted();this._gainNode&&(t?this._gainNode.gain.setValueAtTime(0,this._audioContext.currentTime):this._gainNode.gain.setValueAtTime(this._volume,this._audioContext.currentTime))},t.prototype._loadAll=function(){return $(this,void 0,void 0,function(){var t,e=this;return tt(this,function(n){switch(n.label){case 0:return t=Object.values(u).map(function(t){return $(e,void 0,void 0,function(){var e,n,i;return tt(this,function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),[4,fetch(t)];case 1:return[4,r.sent().arrayBuffer()];case 2:return e=r.sent(),[4,this._audioContext.decodeAudioData(e)];case 3:return n=r.sent(),this._buffers.set(t,n),[3,5];case 4:return i=r.sent(),console.error("Failed to load sound: ".concat(t),i),[3,5];case 5:return[2]}})})}),[4,Promise.all(t)];case 1:return n.sent(),[2]}})})},t.prototype.toggleMute=function(){this._state.toggleMuted(),this._updateGain()},t.prototype.syncState=function(t){var e=this;this._state=t,t.subscribe(h.MUTED,function(){e._updateGain()}),this._updateGain()},t.prototype.getDebugData=function(){var t=0;return this._activeSources.forEach(function(e){return t+=e.length}),{muted:!!this._state&&this._state.isMuted(),volume:this._volume,active_sources:t,loaded_buffers:this._buffers.size}},t}();const nt=et,it=function(){function t(){this._score=0,this._multiplier=1,this._level=1,this._maxLevel=10,this._highScore=0,this._gameId="unknown",this.serialId="score"}return t.prototype.setupGameHighScore=function(t){this._gameId=t,this._highScore=Number(localStorage.getItem("".concat(this._gameId,"::highScore")))},t.prototype.increaseScore=function(t){this._score+=t*this._multiplier,this._score>this._highScore&&(this.highScore=this._score)},t.prototype.resetScore=function(){this._score=0},t.prototype.getFormattedScore=function(t){return void 0===t&&(t=6),this._score.toString().padStart(t,"0")},t.prototype.increaseLevel=function(t){this._level+=t},t.prototype.resetLevel=function(){this._level=1},Object.defineProperty(t.prototype,"multiplier",{get:function(){return this._multiplier},set:function(t){this._multiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this._level},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxLevel",{get:function(){return this._maxLevel},set:function(t){this._maxLevel=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highScore",{get:function(){return this._highScore},set:function(t){this._highScore=t,localStorage.setItem("".concat(this._gameId,"::highScore"),t.toString())},enumerable:!1,configurable:!0}),t.prototype.getDebugData=function(){return{score:this._score,multiplier:this._multiplier,level:this._level,max_level:this._maxLevel}},t.prototype.serialize=function(){return JSON.stringify({score:this._score,multiplier:this._multiplier,level:this._level,max_level:this._maxLevel})},t.prototype.deserialize=function(t){var e=JSON.parse(t);this._score=e.score,this._multiplier=e.multiplier,this._level=e.level,this._maxLevel=e.max_level},t}();var rt,ot=(rt=function(t,e){return rt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},rt(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}rt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});const st=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.serialId="hud_grid",e}return ot(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return 4},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return 4},enumerable:!1,configurable:!0}),e.prototype.serialize=function(){return JSON.stringify({grid:this._grid})},e.prototype.deserialize=function(t){var e=JSON.parse(t);this._grid=e.grid},e}(k),at=function(){function t(){}return t.isSerializable=function(t){if(null==t)return!1;var e=t,n="function"==typeof e.serialize,i="function"==typeof e.deserialize,r="string"==typeof e.serialId;return n&&i&&r},t.isInitializable=function(t){return null!=t&&"function"==typeof t.setup},t.isStateSyncable=function(t){if(null==t)return!1;var e=t;return"function"==typeof e.syncState&&!(e instanceof J)},t.isDebuggable=function(t){return null!=t&&"function"==typeof t.getDebugData},t}();var ut=function(){function t(){this._initialState=new Map,this._baseProperties=[]}return t.prototype.captureBaseProperties=function(t){this._baseProperties=Object.keys(t)},t.prototype.captureInitialState=function(t){var e=this;console.log("capturing initial state for snapshot"),Object.entries(t).forEach(function(t){var n=t[0],i=t[1];if(!e._baseProperties.includes(n)&&"function"!=typeof i){var r=i;try{if(i&&"object"==typeof i){var o=Object.getPrototypeOf(i)===Object.prototype||null===Object.getPrototypeOf(i),s=Array.isArray(i);o||s?r=structuredClone(i):(console.warn("[BrickEngine] Property '".concat(n,"' is a complex object without a clone() or copy() method. A reference will be saved. State reset might not work for its internal properties.")),r=i)}else r=i;console.log("capturing property",n,r)}catch(t){console.error("Failed to clone property '".concat(n,"' (value: ").concat(String(i),"). Saving reference instead. Reset may not work as expected for this property. Error:"),t)}e._initialState.set(n,r)}})},t.prototype.restoreInitialState=function(t){console.log("restoring initial snapshot"),this._initialState.forEach(function(e,n){t[n]=e,console.log("restoring property",n,e)})},t}();const ct=ut,lt=function(){function t(){this._isSessionResolved=!1,this._isModalOpen=!1,this._isEnabled=!0,this._resetFn=function(){},this._serializables=[]}return t.prototype.register=function(t){this._serializables.push(t)},t.prototype.saveSession=function(){var t=this;this._isSessionResolved&&this._isEnabled&&this._serializables.forEach(function(e){localStorage.setItem(t._key(e.serialId),e.serialize())})},t.prototype.clearSession=function(){var t=this;this._serializables.forEach(function(e){localStorage.removeItem(t._key(e.serialId))})},t.prototype.setShowModalFunction=function(t){this._showSessionModal=t},t.prototype.setResetFunction=function(t){this._resetFn=t},t.prototype.setSessionEnabled=function(t){this._isEnabled=t},t.prototype.isModalOpen=function(){return this._isModalOpen},t.prototype.isSessionResolved=function(){return this._isSessionResolved},t.prototype._hasSession=function(){var t=this;return this._serializables.every(function(e){return null!==localStorage.getItem(t._key(e.serialId))})},t.prototype._loadSession=function(){var t=this;this._serializables.forEach(function(e){var n=localStorage.getItem(t._key(e.serialId));n&&e.deserialize(n)})},t.prototype.syncState=function(t){var e=this;t.subscribe(h.PLAYING,function(t){if(t&&!e._isSessionResolved){if(!e._hasSession()||!e._isEnabled)return void(e._isSessionResolved=!0);e._isModalOpen=!0,e._showSessionModal(function(){e._loadSession(),e._isModalOpen=!1,e._isSessionResolved=!0},function(){e.clearSession(),e._resetFn(),e._isModalOpen=!1,e._isSessionResolved=!0})}}),t.subscribe(h.ON,function(t){t||(e._isModalOpen=!1,e._isSessionResolved=!1)}),t.subscribe(h.START,function(t){t||(e._isSessionResolved=!1)})},t.prototype.getDebugData=function(){return{game_id:this.gameId,is_session_resolved:this._isSessionResolved,is_modal_open:this._isModalOpen,is_enabled:this._isEnabled,serializables:this._serializables.map(function(t){return t.serialId}).join(", ")}},t.prototype._key=function(t){return"".concat(this.gameId,"::").concat(t)},t}(),ht=function(){function t(){}return t.setupControlEvents=function(t,e){var n=t.control,i=t.state,r=t.session,o=t.sound;n.subscribe(c.SOUND,l.PRESSED,function(){return i.toggleMuted()}),n.subscribe(c.COLOR,l.PRESSED,function(){return i.toggleColorEnabled()}),n.subscribe(c.EXIT,l.PRESSED,function(){return r.clearSession()}),n.subscribe(c.POWER,l.PRESSED,function(){i.isOn()?(i.turnOff(),o.stopAll()):i.turnOn()}),n.subscribeForGameOverScreen(c.POWER,l.PRESSED,function(){e(),i.resetGameOver()}),n.subscribeForTitleScreen(c.START_PAUSE,l.PRESSED,function(){return i.startGame()}),n.subscribeForPlayingScreen(c.START_PAUSE,l.PRESSED,function(){return i.pause()}),n.subscribeForGameOverScreen(c.START_PAUSE,l.PRESSED,function(){e(),i.resetGameOver()}),n.subscribeForPausedScreen(c.START_PAUSE,l.PRESSED,function(){return i.resume()}),n.subscribeForPlayingScreen(c.RESET,l.PRESSED,function(){e(),i.resetGame()}),n.subscribeForPausedScreen(c.RESET,l.PRESSED,function(){e(),i.resetGame()})},t.setupStateEvents=function(t){var e=t.state,n=t.session;e.subscribe(h.ON,function(e){e||(t.grid.resetGrid(),t.score.resetScore(),t.score.resetLevel(),t.time.reset())}),e.subscribeForGameOverScreen(h.GAME_OVER,function(){n.clearSession()})},t}();var pt=function(){function t(t){this._modules=void 0,this._initialStateSnapshot=new ct,this._gameId="unknown",this._view=t,this._initialStateSnapshot.captureBaseProperties(this)}return Object.defineProperty(t.prototype,"gameId",{get:function(){return this._gameId},set:function(t){this._gameId=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._view},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"modules",{get:function(){return this._modules},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"p",{get:function(){return B.p},enumerable:!1,configurable:!0}),t.prototype.setup=function(){var t=this;this._view.build(),this._modules={renderer:new K,grid:new k,hudGrid:new st,text:new Q,state:new J,control:new b,time:new Z,sound:new nt,score:new it,session:new lt},Object.values(this._modules).forEach(function(t){at.isInitializable(t)&&t.setup()}),Object.values(this._modules).forEach(function(e){at.isStateSyncable(e)&&e.syncState(t._modules.state)}),Object.values(this._modules).forEach(function(e){at.isSerializable(e)&&t._modules.session.register(e)});var e=this._modules,n=e.text,i=e.control,r=e.renderer,o=e.session,s=e.score;o.gameId=this.gameId,o.setShowModalFunction(this._view.showSessionModal.bind(this._view)),o.setResetFunction(this.reset.bind(this)),i.setModules(this._modules),n.setRendererMetrics(r.rendererMetrics),s.setupGameHighScore(this.gameId),this.setupGame(),ht.setupControlEvents(this._modules,this.reset.bind(this)),ht.setupStateEvents(this._modules),this._view.bindControls(i),this._modules.time.captureInitialState(),this._initialStateSnapshot.captureInitialState(this)},t.prototype.draw=function(){var t=B.p;if(this._modules){var e=this._modules,n=e.renderer,i=e.grid,r=e.time,o=e.state,s=e.session;s.isModalOpen()||o.isPlaying()&&!s.isSessionResolved()||(n.render(i.getGrid(),this._modules),o.isOn()&&(o.isStarted()?o.isPlaying()?(r.update(t.deltaTime),r.shouldTick()&&(this.update(t.deltaTime),this._modules.session.saveSession()),this.render()):o.isPaused()&&this.render():this.drawTitleScreen(),o.isGameOver()&&this.drawGameOverScreen()))}},t.prototype.destroy=function(){B.p.noLoop(),this._modules&&(this._modules.control.unbindControls(),this._modules.sound.stopAll())},t.prototype.reset=function(){this._modules.grid.resetGrid(),this._modules.score.resetScore(),this._modules.score.resetLevel(),this._modules.time.reset(),this._modules.session.clearSession(),this._initialStateSnapshot.restoreInitialState(this)},t}();const dt=pt;var ft={grad:.9,turn:360,rad:360/(2*Math.PI)},gt=function(t){return"string"==typeof t?t.length>0:"number"==typeof t},yt=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=Math.pow(10,e)),Math.round(n*t)/n+0},vt=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=1),t>n?n:t>e?t:e},mt=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},_t=function(t){return{r:vt(t.r,0,255),g:vt(t.g,0,255),b:vt(t.b,0,255),a:vt(t.a)}},bt=function(t){return{r:yt(t.r),g:yt(t.g),b:yt(t.b),a:yt(t.a,3)}},Et=/^#([0-9a-f]{3,8})$/i,St=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},wt=function(t){var e=t.r,n=t.g,i=t.b,r=t.a,o=Math.max(e,n,i),s=o-Math.min(e,n,i),a=s?o===e?(n-i)/s:o===n?2+(i-e)/s:4+(e-n)/s:0;return{h:60*(a<0?a+6:a),s:o?s/o*100:0,v:o/255*100,a:r}},xt=function(t){var e=t.h,n=t.s,i=t.v,r=t.a;e=e/360*6,n/=100,i/=100;var o=Math.floor(e),s=i*(1-n),a=i*(1-(e-o)*n),u=i*(1-(1-e+o)*n),c=o%6;return{r:255*[i,a,s,s,u,i][c],g:255*[u,i,i,a,s,s][c],b:255*[s,s,u,i,i,a][c],a:r}},Pt=function(t){return{h:mt(t.h),s:vt(t.s,0,100),l:vt(t.l,0,100),a:vt(t.a)}},Rt=function(t){return{h:yt(t.h),s:yt(t.s),l:yt(t.l),a:yt(t.a,3)}},Ot=function(t){return xt((n=(e=t).s,{h:e.h,s:(n*=((i=e.l)<50?i:100-i)/100)>0?2*n/(i+n)*100:0,v:i+n,a:e.a}));var e,n,i},Ct=function(t){return{h:(e=wt(t)).h,s:(r=(200-(n=e.s))*(i=e.v)/100)>0&&r<200?n*i/100/(r<=100?r:200-r)*100:0,l:r/2,a:e.a};var e,n,i,r},Tt=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,At=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,It=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Mt=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Lt={string:[[function(t){var e=Et.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:4===t.length?yt(parseInt(t[3]+t[3],16)/255,2):1}:6===t.length||8===t.length?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:8===t.length?yt(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=It.exec(t)||Mt.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:_t({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:void 0===e[7]?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=Tt.exec(t)||At.exec(t);if(!e)return null;var n,i,r=Pt({h:(n=e[1],i=e[2],void 0===i&&(i="deg"),Number(n)*(ft[i]||1)),s:Number(e[3]),l:Number(e[4]),a:void 0===e[5]?1:Number(e[5])/(e[6]?100:1)});return Ot(r)},"hsl"]],object:[[function(t){var e=t.r,n=t.g,i=t.b,r=t.a,o=void 0===r?1:r;return gt(e)&&gt(n)&&gt(i)?_t({r:Number(e),g:Number(n),b:Number(i),a:Number(o)}):null},"rgb"],[function(t){var e=t.h,n=t.s,i=t.l,r=t.a,o=void 0===r?1:r;if(!gt(e)||!gt(n)||!gt(i))return null;var s=Pt({h:Number(e),s:Number(n),l:Number(i),a:Number(o)});return Ot(s)},"hsl"],[function(t){var e=t.h,n=t.s,i=t.v,r=t.a,o=void 0===r?1:r;if(!gt(e)||!gt(n)||!gt(i))return null;var s=function(t){return{h:mt(t.h),s:vt(t.s,0,100),v:vt(t.v,0,100),a:vt(t.a)}}({h:Number(e),s:Number(n),v:Number(i),a:Number(o)});return xt(s)},"hsv"]]},Dt=function(t,e){for(var n=0;n<e.length;n++){var i=e[n][0](t);if(i)return[i,e[n][1]]}return[null,void 0]},Gt=function(t,e){var n=Ct(t);return{h:n.h,s:vt(n.s+100*e,0,100),l:n.l,a:n.a}},kt=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},Bt=function(t,e){var n=Ct(t);return{h:n.h,s:n.s,l:vt(n.l+100*e,0,100),a:n.a}},Ft=function(){function t(t){this.parsed=function(t){return"string"==typeof t?Dt(t.trim(),Lt.string):"object"==typeof t&&null!==t?Dt(t,Lt.object):[null,void 0]}(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return null!==this.parsed},t.prototype.brightness=function(){return yt(kt(this.rgba),2)},t.prototype.isDark=function(){return kt(this.rgba)<.5},t.prototype.isLight=function(){return kt(this.rgba)>=.5},t.prototype.toHex=function(){return e=(t=bt(this.rgba)).r,n=t.g,i=t.b,o=(r=t.a)<1?St(yt(255*r)):"","#"+St(e)+St(n)+St(i)+o;var t,e,n,i,r,o},t.prototype.toRgb=function(){return bt(this.rgba)},t.prototype.toRgbString=function(){return e=(t=bt(this.rgba)).r,n=t.g,i=t.b,(r=t.a)<1?"rgba("+e+", "+n+", "+i+", "+r+")":"rgb("+e+", "+n+", "+i+")";var t,e,n,i,r},t.prototype.toHsl=function(){return Rt(Ct(this.rgba))},t.prototype.toHslString=function(){return e=(t=Rt(Ct(this.rgba))).h,n=t.s,i=t.l,(r=t.a)<1?"hsla("+e+", "+n+"%, "+i+"%, "+r+")":"hsl("+e+", "+n+"%, "+i+"%)";var t,e,n,i,r},t.prototype.toHsv=function(){return t=wt(this.rgba),{h:yt(t.h),s:yt(t.s),v:yt(t.v),a:yt(t.a,3)};var t},t.prototype.invert=function(){return Nt({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},t.prototype.saturate=function(t){return void 0===t&&(t=.1),Nt(Gt(this.rgba,t))},t.prototype.desaturate=function(t){return void 0===t&&(t=.1),Nt(Gt(this.rgba,-t))},t.prototype.grayscale=function(){return Nt(Gt(this.rgba,-1))},t.prototype.lighten=function(t){return void 0===t&&(t=.1),Nt(Bt(this.rgba,t))},t.prototype.darken=function(t){return void 0===t&&(t=.1),Nt(Bt(this.rgba,-t))},t.prototype.rotate=function(t){return void 0===t&&(t=15),this.hue(this.hue()+t)},t.prototype.alpha=function(t){return"number"==typeof t?Nt({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):yt(this.rgba.a,3);var e},t.prototype.hue=function(t){var e=Ct(this.rgba);return"number"==typeof t?Nt({h:t,s:e.s,l:e.l,a:e.a}):yt(e.h)},t.prototype.isEqual=function(t){return this.toHex()===Nt(t).toHex()},t}(),Nt=function(t){return t instanceof Ft?t:new Ft(t)};function zt(t,e){var n=B.p,i=n.createDiv();i.parent(t),i.addClass("btn-container");var r=n.createButton(e);return r.parent(i),r.addClass("btn"),r}function Ht(t,e,n){var i=B.p,r=i.createDiv();r.parent(t),r.addClass("sm-btn-container"),r.addClass(n?"sm-btn-container-top":"sm-btn-container-bottom");var o=i.createButton("");o.parent(r),o.addClass("sm-btn");var s=i.createP(e);return s.parent(r),s.addClass("sm-btn-p"),o}var jt=function(){function t(t){this._moduleElements=[],this._gameModules=t}return t.prototype.setup=function(){var t=this;if(d.game.debugger.enabled){var e=B.p,n=e.select("#debugger"),i=!!n&&n.elt.hasAttribute("open"),r=new Set;n&&(e.selectAll(".debugger-module").forEach(function(t){t.elt.hasAttribute("open")&&r.add(t.id())}),n.remove()),this._moduleElements=[];var o=e.createElement("details");o.id("debugger"),i&&o.attribute("open",""),o.parent(e.select("body"));var s=e.createElement("summary");s.id("debugger-summary"),s.html("Debug"),s.parent(o),Object.entries(this._gameModules).forEach(function(n){var i=n[0],s=n[1];if("getDebugData"in s){var a={module:s,properties:[]},u=e.createElement("details");u.class("debugger-module"),u.id("debugger-".concat(i)),r.has("debugger-".concat(i))&&u.attribute("open",""),u.parent(o);var c=e.createElement("summary");c.id("debugger-".concat(i,"-summary")),c.html(i),c.class("debugger-module-summary"),c.parent(u);var l=s.getDebugData();Object.entries(l).forEach(function(t){var n=t[0],i=t[1],r=e.createElement("div");r.class("debugger-container"),r.id("debugger-container-".concat(n,"-").concat(i)),r.parent(u),r.mouseClicked(function(){r.toggleClass("highlight")});var o=e.createElement("p");o.id("debugger-".concat(n,"-").concat(i)),o.html("".concat(n,":")),o.parent(r);var s=e.createElement("span");s.id("debugger-".concat(n,"-").concat(i,"-value")),s.html("".concat(i)),s.parent(r),a.properties.push({key:n,element:s})}),t._moduleElements.push(a)}})}},t.prototype.setGameModules=function(t){this._gameModules=t,this.setup()},t.prototype.update=function(){this._moduleElements.forEach(function(t){var e=t.module.getDebugData();t.properties.forEach(function(t){t.element.html("".concat(e[t.key]))})})},t}();const Ut=jt;var Vt=function(){function t(){}return t.prototype.setup=function(){var t=B.p;this._container=t.createDiv(),this._container.parent(t.select("body")),this._container.id("modal-background"),this._container.class("hidden");var e=t.createDiv();e.parent(this._container),e.id("session-modal");var n=t.createDiv();n.parent(e),n.id("session-modal-frame");var i=t.createP();i.parent(n),i.html("Brick Engine Session");var r=t.createDiv();r.parent(n),r.id("session-modal-screen");var o=t.createP();o.parent(r),o.html("<span>Looks like you have an active session.</span><br><br>Do you want to continue?");var s=t.createDiv();s.parent(e),s.id("session-modal-buttons"),this._cancelButton=t.createButton("Cancel"),this._cancelButton.parent(s),this._cancelButton.class("session-modal-button"),this._confirmButton=t.createButton("Confirm"),this._confirmButton.parent(s),this._confirmButton.class("session-modal-button")},t.prototype.show=function(t,e){var n=this;this._confirmButton.mousePressed(function(){t(),n._hide()}),this._cancelButton.mousePressed(function(){e(),n._hide()}),this._container.removeClass("hidden")},t.prototype._hide=function(){this._confirmButton.mousePressed(null),this._cancelButton.mousePressed(null),this._container.addClass("hidden")},t}();const Wt=Vt;var Kt=function(){function t(t){this._parent=t}return t.prototype.isBodyBuilt=function(){return null!=this._cachedCanvas},t.prototype.build=function(){if(this._cachedCanvas)return this._cachedCanvas;var t,e,n,i,r;t=document.querySelector(":root"),e=window.location.href.substring(window.location.href.indexOf("?")+1),i=(n=new URLSearchParams(e)).has(d.inputQueryParams.mainColor)?n.get(d.inputQueryParams.mainColor):d.colors.bodyMain,r=n.has(d.inputQueryParams.buttonColor)?n.get(d.inputQueryParams.buttonColor):d.colors.bodyButton,t.style.setProperty("--main-color",i),t.style.setProperty("--button-color",r),t.style.setProperty("--color-shadow",Nt(i).darken(.15).toHex()),t.style.setProperty("--color-shadow-reflexion",Nt(i).lighten(.15).toHex()),t.style.setProperty("--button-color-reflexion",Nt(r).lighten(.15).toHex()),t.style.setProperty("--button-color-shadow",Nt(r).darken(.15).toHex());var o=function(t){var e,n=B.p.createDiv();if(n.parent(d.selectors.parent),n.id(d.selectors.viewElementIds.container),t.clientWidth<=d.viewLayout.mobileBreakpoint)return{container:n,width:e=t.clientWidth,height:t.clientHeight};var i=t.clientHeight/(1.05*d.viewLayout.bodyHeightWidthMultiplier);return{container:n,width:e=Math.min(t.clientWidth,i),height:e*d.viewLayout.bodyHeightWidthMultiplier}}(this._parent),s=o.container,a=o.height,u=o.width,c=function(t){var e=B.p,n=e.createDiv();n.parent(t),n.id(d.selectors.viewElementIds.frame);var i=e.createDiv();return i.parent(n),e.createP("Brick Game").parent(i),n}(s),l=function(t,e){var n=B.p,i=e*d.viewLayout.canvas.widthRatio,r=i*d.viewLayout.canvas.aspectRatio,o=n.createCanvas(i,r);return o.parent(t),o.id(d.selectors.viewElementIds.canvas),{canvasWidth:i,canvasHeight:r,canvas:o}}(c,u),h=l.canvas,p=l.canvasHeight,f=l.canvasWidth,g=function(t){var e=B.p,n=e.createDiv();n.parent(t),n.id(d.selectors.viewElementIds.buttonContainer);var i=e.createDiv();i.parent(n),i.id(d.selectors.viewElementIds.smallButtonContainer);var r=e.createDiv();r.parent(n),r.id(d.selectors.viewElementIds.innerButtonContainer);var o=e.createDiv();o.parent(r),o.id(d.selectors.viewElementIds.mediumButtonContainer);var s=e.createDiv();s.parent(o),s.id(d.selectors.viewElementIds.directionVerticalContainer);var a=e.createDiv();a.parent(o),a.id(d.selectors.viewElementIds.directionHorizontalContainer);var u=e.createDiv();return u.parent(r),u.id(d.selectors.viewElementIds.largeButtonContainer),{smallButtonContainer:i,mediumButtonContainer:o,largeButtonContainer:u,directionVerticalContainer:s,directionHorizontalContainer:a}}(s),y=g.largeButtonContainer,v=g.smallButtonContainer,m=g.directionHorizontalContainer,_=g.directionVerticalContainer;return this._onOffBtn=Ht(v,"On<br/>Off",!0),this._startPauseBtn=Ht(v,"Start<br/>Pause",!1),this._soundBtn=Ht(v,"Sound",!0),this._resetBtn=Ht(v,"Reset",!1),this._exitBtn=Ht(v,"Exit",!0),this._enableColorBtn=Ht(v,"Enable<br/>Colors",!1),this._upBtn=zt(_,"UP"),this._leftBtn=zt(m,"LEFT"),this._downBtn=zt(_,"DOWN"),this._rightBtn=zt(m,"RIGHT"),this._actionBtn=function(t){var e=B.p,n=e.createDiv();n.parent(t),n.addClass("lg-btn-container");var i=e.createButton("Action");return i.parent(n),i.addClass("lg-btn"),i}(y),function(t,e,n,i){var r=document.querySelector(":root");r.style.setProperty("--dispersion",d.viewLayout.shadowDispersion),r.style.setProperty("--width","".concat(t,"px")),r.style.setProperty("--height","".concat(e,"px")),r.style.setProperty("--canvas-width","".concat(n,"px")),r.style.setProperty("--canvas-height","".concat(i,"px")),r.style.setProperty("--border-radius","".concat(t*d.viewLayout.dimensions.borderRadiusRatio,"px")),r.style.setProperty("--border","".concat(t*d.viewLayout.dimensions.borderWidthRatio,"px solid black")),r.style.setProperty("--sm-button-size","".concat(t*d.viewLayout.dimensions.button.smSizeRatio,"px")),r.style.setProperty("--button-size","".concat(t*d.viewLayout.dimensions.button.mdSizeRatio,"px")),r.style.setProperty("--lg-button-size","".concat(t*d.viewLayout.dimensions.button.lgSizeRatio,"px")),r.style.setProperty("--sm-button-size-mobile","".concat(t*d.viewLayout.dimensions.button.mobile.smSizeRatio,"px")),r.style.setProperty("--button-size-mobile","".concat(t*d.viewLayout.dimensions.button.mobile.mdSizeRatio,"px")),r.style.setProperty("--lg-button-size-mobile","".concat(t*d.viewLayout.dimensions.button.mobile.lgSizeRatio,"px")),r.style.setProperty("--sm-button-size-mobile-font-size","".concat(t*d.viewLayout.dimensions.button.mobile.smFontRatio,"px")),r.style.setProperty("--sm-button-size-mobile-line-height","".concat(t*d.viewLayout.dimensions.button.mobile.smFontRatio,"px")),r.style.setProperty("--button-size-mobile-font-size","".concat(t*d.viewLayout.dimensions.button.mobile.fontRatio,"px")),r.style.setProperty("--lg-button-size-mobile-font-size","".concat(t*d.viewLayout.dimensions.button.mobile.lgFontRatio,"px")),r.style.setProperty("--button-size-mobile-spacing","".concat(t*d.viewLayout.dimensions.button.mobile.spacingRatio,"px")),r.style.setProperty("--button-border","".concat(t*d.viewLayout.dimensions.button.borderRatio,"px solid black")),r.style.setProperty("--button-animation-duration",d.viewLayout.dimensions.button.animationDuration)}(u,a,f,p),this._hideSplash(),this._cachedCanvas={canvas:h,canvasWidth:f,canvasHeight:p},this._cachedCanvas},t.prototype.setupSessionModal=function(){this._sessionModal=new Wt,this._sessionModal.setup()},t.prototype.showSessionModal=function(t,e){this._sessionModal.show(t,e)},t.prototype.setupDebugger=function(t){this._debugger=new Ut(t),this._debugger.setup()},t.prototype.updateDebuggerGameModules=function(t){this._debugger.setGameModules(t)},t.prototype.updateDebugger=function(){this._debugger.update()},t.prototype.bindControls=function(t){this._inputHandler=new f(t),this._bindButtonEvents(this._onOffBtn,c.POWER),this._bindButtonEvents(this._startPauseBtn,c.START_PAUSE),this._bindButtonEvents(this._soundBtn,c.SOUND),this._bindButtonEvents(this._resetBtn,c.RESET),this._bindButtonEvents(this._exitBtn,c.EXIT),this._bindButtonEvents(this._enableColorBtn,c.COLOR),this._bindButtonEvents(this._upBtn,c.UP),this._bindButtonEvents(this._downBtn,c.DOWN),this._bindButtonEvents(this._rightBtn,c.RIGHT),this._bindButtonEvents(this._leftBtn,c.LEFT),this._bindButtonEvents(this._actionBtn,c.ACTION)},t.prototype.unbindControls=function(){this._onOffBtn.mousePressed(function(){}).mouseReleased(function(){}),this._startPauseBtn.mousePressed(function(){}).mouseReleased(function(){}),this._soundBtn.mousePressed(function(){}).mouseReleased(function(){}),this._resetBtn.mousePressed(function(){}).mouseReleased(function(){}),this._exitBtn.mousePressed(function(){}).mouseReleased(function(){}),this._enableColorBtn.mousePressed(function(){}).mouseReleased(function(){}),this._upBtn.mousePressed(function(){}).mouseReleased(function(){}),this._downBtn.mousePressed(function(){}).mouseReleased(function(){}),this._rightBtn.mousePressed(function(){}).mouseReleased(function(){}),this._leftBtn.mousePressed(function(){}).mouseReleased(function(){}),this._actionBtn.mousePressed(function(){}).mouseReleased(function(){})},t.prototype._bindButtonEvents=function(t,e){var n=this;t.mousePressed(function(){return n._inputHandler.handlePress(e)}),t.mouseReleased(function(){return n._inputHandler.handleRelease(e)}),t.mouseOut(function(){return n._inputHandler.handleRelease(e)})},t.prototype._hideSplash=function(t){void 0===t&&(t=d.viewLayout.splashHideDelayMs);var e=document.querySelector(d.selectors.splash);setTimeout(function(){e.style.display="none"},t)},t}();const Yt=Kt;var Xt,Jt=i(991),qt=i.n(Jt);function Qt(t){Xt=t}function Zt(t){return window.BrickEngineGame=t,new(qt())(function(e){B.init(e);var n=new Yt(document.body);Qt(new t(n)),"unknown"===Xt.gameId&&(Xt.gameId="game"),e.setup=function(){Xt.setup(),Xt.view.setupDebugger(Xt.modules),Xt.view.setupSessionModal()},e.draw=function(){Xt.draw(),Xt.view.updateDebugger()}})}return p})(),t.exports=i(n(472))}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var o=e[i]={exports:{}};return t[i](o,o.exports,n),o.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=n(229),e=n(472),i=n.n(e);const r=function(){function t(){this._games=[{id:"loading",name:"Loading",url:""}],this.fetchGames()}return t.prototype.fetchGames=function(){return t=this,e=void 0,i=function(){var t,e,n,i;return function(t,e){var n,i,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),(t={}).Authorization="Bearer ".concat("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVpZXhtcGtxdmJrcHJoaWZpeWFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4NTY3ODIsImV4cCI6MjA4NzQzMjc4Mn0.OHI8RBANokqtgRBytBTO0FiB_p_JHjq0mW2wwfzlZDs"),[4,fetch("".concat("https://uiexmpkqvbkprhifiyaj.supabase.co","/functions/v1/list"),{headers:t})];case 1:if(!(e=r.sent()).ok)throw new Error("Error fetching games: ".concat(e.statusText));return[4,e.json()];case 2:return(n=r.sent())&&n.games&&n.games.length>0?this._games=n.games.map(function(t){return{id:t.id,name:t.name,url:t.url}}):this._games=[{id:"empty",name:"Not found",url:""}],[3,4];case 3:return i=r.sent(),console.error(i),this._games=[{id:"error",name:"Error",url:""}],[3,4];case 4:return[2]}})},new((n=void 0)||(n=Promise))(function(r,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(s,a)}u((i=i.apply(t,e||[])).next())});var t,e,n,i},Object.defineProperty(t.prototype,"games",{get:function(){return Object.freeze(this._games)},enumerable:!1,configurable:!0}),t}(),o=function(){function t(){}return t.setInstance=function(e){t._instance=e},t.getInstance=function(){return t._instance},t.hasInstance=function(){return void 0!==t._instance},t}();const s=function(){function e(){}return e.prototype.handleGameSwitch=function(t,e){return n=this,i=void 0,o=function(){var n,i;return function(t,e){var n,i,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._loadGameScript(t.url)];case 1:return r.sent(),window.BrickEngineGame?((n=new window.BrickEngineGame(e.view)).gameId=t.id,this.switchTo(n,e),delete window.BrickEngineGame):console.error("Game bundle loaded but window.BrickEngineGame was not set."),[3,3];case 2:return i=r.sent(),console.error("Failed to load game:",i),[3,3];case 3:return[2]}})},new((r=void 0)||(r=Promise))(function(t,e){function s(t){try{u(o.next(t))}catch(t){e(t)}}function a(t){try{u(o.throw(t))}catch(t){e(t)}}function u(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r(function(t){t(n)})).then(s,a)}u((o=o.apply(n,i||[])).next())});var n,i,r,o},e.prototype.switchTo=function(e,n){var i=this;try{n.destroy(),(0,t.setActiveGame)(e),e.setup();var r=e.modules,s=r.control,a=r.state;e.view.updateDebuggerGameModules(e.modules),e.p.loop(),e.view.bindControls(s),a.turnOn(),o.hasInstance()&&e!==o.getInstance()&&(s.subscribe(t.ControlKey.EXIT,t.ControlEventType.PRESSED,function(){i.switchTo(o.getInstance(),e)}),s.subscribe(t.ControlKey.POWER,t.ControlEventType.PRESSED,function(){a.isOn()&&(i.switchTo(o.getInstance(),e),a.turnOff())}))}catch(t){console.error("Error switching game:",t)}},e.prototype._loadGameScript=function(t){return new Promise(function(e,n){var i=document.getElementById("game-client-script");i&&i.remove();var r=document.createElement("script");r.src=t,r.id="game-client-script",r.crossOrigin="anonymous",r.onload=function(){return e()},r.onerror=function(){return n(new Error("Failed to load script ".concat(t)))},document.head.appendChild(r)})},e}();var a,u=(a=function(t,e){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},a(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});const c=function(e){function n(t){var n=e.call(this,t)||this;return n._gameSelectionPointer=0,n._isLoading=!1,n._gameRepository=new r,n._gameManager=new s,o.setInstance(n),n}return u(n,e),n.prototype.setupGame=function(){var e=this;this.gameId="game-menu";var n=this.modules,i=n.state,r=n.control,o=n.sound;n.session.setSessionEnabled(!1),r.subscribe(t.ControlKey.ACTION,t.ControlEventType.PRESSED,function(){if(!e._isLoading&&i.isStarted()){var t=e._gameRepository.games[e._gameSelectionPointer];e._gameManager.handleGameSwitch(t,e)}}),r.subscribe(t.ControlKey.LEFT,t.ControlEventType.PRESSED,function(){i.isPlaying()&&(o.play(t.Sound.ACTION_1),0===e._gameSelectionPointer?e._gameSelectionPointer=e._gameRepository.games.length-1:e._gameSelectionPointer--)}),r.subscribe(t.ControlKey.RIGHT,t.ControlEventType.PRESSED,function(){i.isPlaying()&&(o.play(t.Sound.ACTION_1),e._gameSelectionPointer===e._gameRepository.games.length-1?e._gameSelectionPointer=0:e._gameSelectionPointer++)}),i.subscribe(t.StateProperty.ON,function(e){e&&o.play(t.Sound.START_THEME)})},n.prototype.update=function(){},n.prototype.render=function(){var e=this.modules.text,n=this.p;n.push(),e.setTextSize(t.FontSize.LARGE),e.setActiveText(),e.setTextAlign(t.FontAlign.CENTER,t.FontVerticalAlign.BOTTOM),e.textOnDisplay("Menu",{x:.5,y:.15}),e.setTextSize(t.FontSize.SMALL),e.textOnDisplay("Choose a game and",{x:.5,y:.25}),e.textOnDisplay("Press action to play",{x:.5,y:.32}),e.setTextAlign(t.FontAlign.RIGHT,t.FontVerticalAlign.BOTTOM),e.textOnDisplay("<",{x:.1,y:.54}),e.setTextAlign(t.FontAlign.LEFT,t.FontVerticalAlign.BOTTOM),e.textOnDisplay(">",{x:.9,y:.54}),e.setTextSize(t.FontSize.MEDIUM),e.setTextAlign(t.FontAlign.CENTER,t.FontVerticalAlign.BOTTOM),e.textOnDisplay(this._gameRepository.games[this._gameSelectionPointer].name,{x:.5,y:.55}),e.setTextSize(t.FontSize.EXTRA_SMALL),e.setTextAlign(t.FontAlign.LEFT,t.FontVerticalAlign.BOTTOM),e.textOnDisplay("Left:    Previous option",{x:.05,y:.78}),e.textOnDisplay("Right:   Next option",{x:.05,y:.84}),e.textOnDisplay("Action:  Select",{x:.05,y:.9}),n.pop()},n.prototype.drawTitleScreen=function(){var e=this.modules.text;this.p.push(),e.setTextSize(t.FontSize.LARGE),e.setActiveText(),e.setTextAlign(t.FontAlign.CENTER,t.FontVerticalAlign.TOP),e.textOnDisplay("Menu",{x:.5,y:.15}),e.setTextSize(t.FontSize.SMALL),e.textOnDisplay("Wellcome to your",{x:.5,y:.25}),e.textOnDisplay("favorite brick game",{x:.5,y:.32}),e.textOnDisplay("simulator!",{x:.5,y:.39}),e.textOnDisplay("Press start",{x:.5,y:.66}),e.textOnDisplay("to continue.",{x:.5,y:.72}),this.p.pop()},n.prototype.drawGameOverScreen=function(){},n}(t.Game);window.BrickEngine=t,window.p5=i(),(0,t.bootstrap)(c)})()})();